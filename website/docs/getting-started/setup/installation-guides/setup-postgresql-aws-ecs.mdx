---
description: This page outlines the steps to setup a PostgreSQL RDS for your AWS ECS on EC2 or Fargate instances.
toc_max_heading_level: 2
hide_title: true
title: Setup PostgreSQL RDS
---

<!-- vale off -->

<div className="tag-wrapper">
 <h1> Setup PostgreSQL RDS on AWS ECS for SAML SSO</h1>

<Tags
tags={[
{ name: "Enterprise", link: "https://www.appsmith.com/pricing", additionalClass: "enterprise" }
]}
/>

</div>

<!-- vale on -->

Before you configure Security Assertion Markup Language (SAML) Single Sign-On (SSO) for Appsmith installation on AWS ECS using EC2 or Fargate instances, you need to setup a PostgreSQL RDS instance to store the Keycloak data. This page outlines the steps to setup a PostgreSQL RDS for your AWS ECS on EC2 or Fargate instances.

## Prerequisites

- Amazon Web Services (AWS) account. If you don't have one, [Create an AWS Account](https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/).
- An Appsmith Commercial Edition installation using AWS ECS on EC2 or Fargate. If not installed yet, see the [AWS ECS on EC2](https://docs.appsmith.com/getting-started/setup/installation-guides/aws-ecs) or [AWS ECS on Fargate](https://docs.appsmith.com/getting-started/setup/installation-guides/aws-ecs-on-fargate) installation guides for installing Appsmith.
- At least 2 GB of free storage space for backup and update tasks.
- Backup your [Appsmith instance](https://docs.appsmith.com/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#backup-instance)
- Access to run `supervisorctl` commands.

## Backup Keycloak data

Follow the below steps to backup Keycloak data:

1. Stop the Keycloak with:

    ```bash
    supervisorctl stop keycloak
    ```

2. Create a backup with:

    ```bash
    /bin/sh /opt/keycloak/bin/standalone.sh -c standalone.xml \
    -b 0.0.0.0 -Djboss.socket.binding.port-offset=1 \
    -Dkeycloak.migration.action=export -Dkeycloak.migration.provider=dir \
    -Dkeycloak.migration.dir=<PATH_TO_THE_BACKUP_DIRECTORY>
    ```
    Ensure that you replace the `<PATH_TO_THE_BACKUP_DIRECTORY>` parameter with the path of the backup directory.

## Setup PostgreSQL

Follow the below steps to setup PostgreSQL RDS instance:

- Go to RDS on Amazon management console and click **Create database**
- On **Create database** screen, setup the database configuration as shown below:
    * **Standard create** for **database creation method** 
    * **PostgreSQL** for **Engine options**
    * Select **Engine version** as **PostgreSQL 12.11-R1** or above
    * **Free tier** for the **Templates**
    * **DB instance identifier** - give a meaningful name to the DB instance- `appsmith-keycloak`
    * Under **Credentials Settings**:
        * Add a username or use the default name as **postgres**
        * Either choose to an autogenerated password or add your own strong password for Master Password
      Keep a note of these credentials, as you will need the credentials to connect Keycloak RDS from the Appsmith instance.
    * If you may wish, you may choose to configure Backup, monitoring and encryption details
 For other fields keep the default selections.
- Click the **Create database** button to create the RDS instance
- Once the instance is up note the endpoint URL to connect Keycloak RDS from the Appsmith Instance.

## Configure Appsmith task definition

- Go to AWS ECS and select the Appsmith Service
- Go to Task Definition and select the Appsmith Task definition
- Edit the Task Definition
- In the Environment variables section, add the below environment vairables
    - APPSMITH_KEYCLOAK_DB_URL - Add endpoint url
    - APPSMITH_KEYCLOAK_DB_DRIVER - Postgres
    - APPSMITH_KEYCLOAK_DB_USERNAME - DB Username
    - APPSMITH_KEYCLOAK_DB_PASSWORD - DB Password
- Save the Task Definition
- Restart the Appsmith service.


## Restore Keycloak data

Follow below steps to restore Keycloak data:

1. Run the below command to restore the data:

    ```bash
    /bin/sh /opt/keycloak/bin/standalone.sh -c standalone.xml \
    -b 0.0.0.0 -Djboss.socket.binding.port-offset=1 \
    -Dkeycloak.migration.action=import -Dkeycloak.migration.provider=dir \
    -Dkeycloak.migration.dir=<PATH_TO_THE_BACKUP_DIRECTORY>
    ```
    Ensure that you replace the `<PATH_TO_THE_BACKUP_DIRECTORY>` parameter with the path of the backup directory.

2. Start Keycloak with:

    ```bash
    supervisorctl start keycloak
    ``` 

After Keycloak is up and running, verify Appsmith by logging into your Appsmith account.

## Troubleshooting

If you see errors, you can roll back to a previous version to fix the issue. For more information, see the [Restore instance](https://docs.appsmith.com/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#restore-instance) section. If you continue to face issues, contact the support team using the chat widget at the bottom right of this page.