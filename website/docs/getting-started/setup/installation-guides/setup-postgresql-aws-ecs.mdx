---
description: This page outlines the steps to set up a PostgreSQL RDS for your AWS ECS on EC2 or Fargate instances.
toc_max_heading_level: 2
hide_title: true
title: Setup PostgreSQL RDS
---

<!-- vale off -->

<div className="tag-wrapper">
 <h1> Setup PostgreSQL RDS for SAML SSO</h1>

<Tags
tags={[
{ name: "Enterprise", link: "https://www.appsmith.com/pricing", additionalClass: "enterprise" }
]}
/>

</div>

<!-- vale on -->

Before you configure Security Assertion Markup Language (SAML) Single Sign-On (SSO) for Appsmith installation on AWS ECS using EC2 or Fargate instances, you need to set up a PostgreSQL RDS instance to store the Keycloak data. This page outlines the steps to set up a PostgreSQL RDS for your AWS ECS on EC2 or Fargate instances.

## Prerequisites

- Amazon Web Services (AWS) account. If you don't have one, [Create an AWS Account](https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/).
- An Appsmith Commercial Edition installation using AWS ECS on EC2 or Fargate. If not installed yet, see the [AWS ECS on EC2](https://docs.appsmith.com/getting-started/setup/installation-guides/aws-ecs) or [AWS ECS on Fargate](https://docs.appsmith.com/getting-started/setup/installation-guides/aws-ecs-on-fargate) installation guides for installing Appsmith.
- At least 2 GB of free storage space for backup and update tasks.
- Backup your [Appsmith instance](https://docs.appsmith.com/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#backup-instance)
- Access to run `supervisorctl` commands.

## Backup Keycloak data

Follow the below steps to backup Keycloak data:

1. Stop the Keycloak with:

    ```bash
    supervisorctl stop keycloak
    ```

2. Create a backup with:

    ```bash
    /bin/sh /opt/keycloak/bin/standalone.sh -c standalone.xml \
    -b 0.0.0.0 -Djboss.socket.binding.port-offset=1 \
    -Dkeycloak.migration.action=export -Dkeycloak.migration.provider=dir \
    #highlight-next-line
    -Dkeycloak.migration.dir=<PATH_TO_THE_BACKUP_DIRECTORY>
    ```
    Ensure that you replace the `<PATH_TO_THE_BACKUP_DIRECTORY>` parameter with the path of the backup directory.

3. Start Keycloak with:

    ```bash
    supervisorctl start keycloak
    ``` 

## Setup PostgreSQL

Follow the below steps to set up PostgreSQL RDS instance:

- Go to RDS on Amazon management console and click **Create database**
- On **Create database** screen, add the database configuration as shown below:
    * **Database creation method** - Standard create  
    * **Engine options**- PostgreSQL
    * **Engine version**- **PostgreSQL 12.11-R1** or above
    * **Templates**- Free tier
    * **DB instance identifier**- give a meaningful name to the DB instance. For example, `appsmith-keycloak`
    * Under **Credentials Settings**:
        * Add a username or use the default name as **postgres**
        * Either choose an autogenerated password or add your own strong password for the Master Password
      Keep a note of these credentials, as you will need the credentials to connect Keycloak RDS from the Appsmith instance.
    * If you wish, you may choose to configure Backup, monitoring, and encryption details. For all other fields keep the default selections.
- Click the **Create database** button to create the RDS instance
- Once the instance is up note the endpoint URL to connect Keycloak RDS from the Appsmith Instance.

## Update Appsmith task definition

Follow the below steps to configure your Appsmith task definition to use the newly created EFS:

1. Go to the AWS Management Console, open the Amazon ECS console, and select **Task Definitions** from the sidebar.
2. Select your existing task definition, and click the **Create new revision** button to create a new revision of the task definition.
3. Go to the **Container-1** section, click the **Add environment variable** button, and add the below environment variables in **Key** and their values in **Value**: 
    - **APPSMITH_KEYCLOAK_DB_URL** - Add the endpoint URL you noted down in the [Setup PostgreSQL](#setup-postgresql) section
    - **APPSMITH_KEYCLOAK_DB_DRIVER** - postgresql
    - **APPSMITH_KEYCLOAK_DB_USERNAME** -  Add the database username you noted down in the [Setup PostgreSQL](#setup-postgresql) section
    - **APPSMITH_KEYCLOAK_DB_PASSWORD** - Add the database password you noted down in the [Setup PostgreSQL](#setup-postgresql) section
4. Keep default values for other settings, and click the **Create** button.

## Update Appsmith ECS service

Follow the below steps to update your Appsmith service to use the newly created task definition:

1. Go to the AWS Management Console, open the Amazon ECS console, select your ECS Cluster, and go to the **Services** tab.
2. Select your service and click the **Update** button.
3. Check the **Force new deployment** checkbox
4. In the **Task definition**, select the newly created revision for the **Revision** setting.
5. Click the **Update** button to save the changes and initiate a new deployment.
6. Verify the service **Last status** shown as **Running**, which means that the service is up and running.

## Restore Keycloak data

Follow the below steps to restore Keycloak data:

1. Stop the Keycloak with:

    ```bash
    supervisorctl stop keycloak
    ```

2. Run the below command to restore the data:

    ```bash
    /bin/sh /opt/keycloak/bin/standalone.sh -c standalone.xml \
    -b 0.0.0.0 -Djboss.socket.binding.port-offset=1 \
    -Dkeycloak.migration.action=import -Dkeycloak.migration.provider=dir \
    #highlight-next-line
    -Dkeycloak.migration.dir=<PATH_TO_THE_BACKUP_DIRECTORY>
    ```
    Ensure that you replace the `<PATH_TO_THE_BACKUP_DIRECTORY>` parameter with the path of the backup directory.

3. Start Keycloak with:

    ```bash
    supervisorctl start keycloak
    ``` 

After Keycloak is up and running, verify Appsmith by logging into your Appsmith account.

## Troubleshooting

If you see errors, you can roll back to a previous version to fix the issue. For more information, see the [Restore instance](https://docs.appsmith.com/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#restore-instance) section. If you continue to face issues, contact the support team using the chat widget at the bottom right of this page.