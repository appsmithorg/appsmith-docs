---
description: This page outlines how to setup high availability for Appsmith on AWS ECS using Fargate.
title: AWS ECS on Fargate
toc_max_heading_level: 2
---

# Configure High Availability on Fargate

This page outlines the steps required to set up high availability for your Appsmith installation on AWS ECS with Fargate. High availability ensures that your Appsmith instance remains accessible without interruption, even during system disruptions.

## Prerequisites

Before you begin setting up high availability for Appsmith, ensure that you have the following prerequisites in place:

- An **AWS account**. If you don’t have one, see [Create an AWS account](https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/).
- **Appsmith installation**: Make sure Appsmith Commercial Edition is installed on AWS ECS with Fargate. For setup details, refer to the [AWS ECS on Fargate installation guide](/getting-started/setup/installation-guides/aws-ecs-on-fargate).
- At least **2 GB of free storage** for backups and updates.
- **Database configurations**: External databases for MongoDB, Redis, and PostgreSQL need to be set up (as detailed below).
- Backup your Appsmith instance using the steps outlined in the [Backup Appsmith instance](#backup-appsmith-instance) section.
- **Access to run `supervisorctl` commands** on Keycloak.

## Backup Appsmith instance

Before making any changes, ensure you back up your Appsmith instance to safeguard your data. This backup can be used to restore your instance in case of any issues during the high availability setup process.

1. Run the following command to back up your Appsmith instance:
```
   appsmithctl backup
```
2. Save the backup files securely for recovery if needed.

## Set up external databases

High availability for Appsmith requires configuring external databases for **MongoDB**, **Redis**, and **PostgreSQL**. Each of these databases needs to be set up correctly to ensure a robust, scalable environment.

### Configure MongoDB

Appsmith requires MongoDB to store application data. In this section, you will set up an external MongoDB instance.

1. Set up an external MongoDB instance by following the instructions in the [MongoDB setup guide](/getting-started/setup/instance-configuration/custom-mongodb-redis#external-mongodb).
2. Once set up, make sure to note down the connection string for MongoDB, as it will be used in later steps.

### Configure Redis

Appsmith also relies on Redis for caching and session storage. To configure Redis for high availability:

1. Set up an external Redis instance by following the instructions in the [Redis setup guide](/getting-started/setup/instance-configuration/custom-mongodb-redis#external-redis).
2. Once set up, note the connection string for Redis, which will be used in later steps.

### Configure PostgreSQL

PostgreSQL is required to store Keycloak data for SAML SSO and high availability. Follow the steps below to configure PostgreSQL, and ensure your system is ready to handle authentication services effectively.

#### Backup Keycloak data

Before setting up PostgreSQL for Keycloak, it's important to back up Keycloak's data. This ensures you do not lose any configuration or user data during the migration process.

1. Navigate to the Keycloak directory:
```
   cd /opt/keycloak/bin
```
2. Export Keycloak data to a backup directory:
```
   ./kc.sh export --dir /appsmith-stacks/data/kc_data/
```
3. Verify that the data is backed up in the specified directory to ensure no data is lost.

#### Set up Keycloak PostgreSQL RDS

Now, set up the PostgreSQL RDS instance that will be used by Keycloak for authentication storage.

1. Go to the **RDS** section in the AWS Management Console and click **Create database**.
2. Configure the database:
   - **Database creation method**: Standard create  
   - **Engine options**: PostgreSQL  
   - **Engine version**: PostgreSQL 12.11-R1 or above  
   - **Templates**: Free tier  
   - **DB instance identifier**: For example, `appsmith-keycloak`  
   - **Credentials**: Set username (`postgres` by default) and a strong password.
3. Click **Create database** to finalize the setup.
4. Note the **endpoint URL** from the **Connectivity & security** tab, as you'll need this for the Keycloak setup.

#### Restore Keycloak data

Once the PostgreSQL RDS instance is set up, you will need to restore the backed-up Keycloak data to the new PostgreSQL database.

1. Navigate to the Keycloak directory:
```
   cd /opt/keycloak/bin
```
2. Stop the Keycloak service:
```
   supervisorctl stop keycloak
```
3. Import the backup data into PostgreSQL:
```
   ./kc.sh import --db postgres --db-password ${APPSMITH_KEYCLOAK_DB_PASSWORD} --db-username ${APPSMITH_KEYCLOAK_DB_USERNAME} --db-url "jdbc:${APPSMITH_KEYCLOAK_DB_DRIVER}://${APPSMITH_KEYCLOAK_DB_URL}" --dir /appsmith-stacks/data/kc_data/
```
4. Once the data is restored, restart Keycloak:
```
   supervisorctl start keycloak
```

Verify that Keycloak is running properly by logging into the Appsmith dashboard after the restoration.

## Configure high availability

To ensure Appsmith is highly available, configure it to use multiple instances, redundancy, and external databases.

### Update task definition

1. Go to the **Amazon ECS console** and select **Task Definitions**.
2. Select your Appsmith task definition and click **Create new revision**.
3. Add the following environment variables under **Container-1**:
   - `APPSMITH_DB_URL=<MongoDB connection string>`
   - `APPSMITH_REDIS_URL=<Redis connection string>`
   - `APPSMITH_KEYCLOAK_DB_URL=<PostgreSQL endpoint>`
   - `APPSMITH_KEYCLOAK_DB_DRIVER=postgresql`
   - `APPSMITH_KEYCLOAK_DB_USERNAME=<PostgreSQL username>`
   - `APPSMITH_KEYCLOAK_DB_PASSWORD=<PostgreSQL password>`
4. Save the updated task definition.

### Update ECS service

To deploy your changes and ensure high availability, follow these steps:

1. Go to the **Amazon ECS console** and select your ECS Cluster.
2. Navigate to the **Services** tab and select your Appsmith service.
3. Click **Update**, check **Force new deployment**, and select the latest task definition revision.
4. Update the **Desired tasks** to `2` for redundancy.
5. Save the changes to initiate a new deployment.
6. Verify the service’s **Last status** is **Running**.

### Verify high availability

Once the deployment is complete, test the high availability setup by performing the following checks:

1. Simulate a failover by terminating one task in your ECS service.
2. Verify if the remaining task continues handling traffic seamlessly without any downtime.
3. Ensure that no data is lost and that the system is highly available during the failover process.

## Troubleshooting

If you encounter issues, follow these steps:

- Check the **logs** in the ECS console for detailed error messages that may indicate the root cause.
- To roll back to a previous version of the Appsmith instance, follow the [Restore instance](/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#restore-instance) guide.
- If you continue facing issues, reach out for support via the chat widget on the Appsmith documentation site.

## See also

- [SAML Single Sign-On](/getting-started/setup/instance-configuration/authentication/security-assertion-markup-language-saml)
- [Restore Appsmith instance](/getting-started/setup/instance-management/appsmithctl?current-command-type=docker-commands#restore-instance)
- [Configure MongoDB and Redis](/getting-started/setup/instance-configuration/custom-mongodb-redis)